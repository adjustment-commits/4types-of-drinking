<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ALTIé£²é…’ã‚¿ã‚¤ãƒ—è¨ºæ–­</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f2027">
<link rel="apple-touch-icon" href="icons-192.png">
<link rel="stylesheet" href="style.css">
</head>

<body>
<h1>ALTIé£²é…’ã‚¿ã‚¤ãƒ—è¨ºæ–­</h1>

<!-- ğŸ”¹ è³ªå•ãƒ•ã‚©ãƒ¼ãƒ  -->
<div id="quiz">
  <form id="altiForm">
    <div class="question"><p>1. ãŠé…’ã‚’é£²ã‚“ã§10åˆ†ä»¥å†…ã«é¡”ãŒèµ¤ããªã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚</p>
      <label><input type="radio" name="q1" value="slow"> ã¯ã„</label>
      <label><input type="radio" name="q1" value="fast"> ã„ã„ãˆ</label></div>

    <div class="question"><p>2. ãƒ“ãƒ¼ãƒ«1æ¯ã§ã‚‚å‹•æ‚¸ã‚„æ¯è‹¦ã—ã•ã‚’æ„Ÿã˜ã‚‹ã“ã¨ãŒã‚ã‚‹ã€‚</p>
      <label><input type="radio" name="q2" value="slow"> ã¯ã„</label>
      <label><input type="radio" name="q2" value="fast"> ã„ã„ãˆ</label></div>

    <div class="question"><p>3. å°‘é‡ã§ã‚‚ä½“ãŒç†±ããªã‚Šã€æ‰‹è¶³ãŒã»ã¦ã‚‹ã€‚</p>
      <label><input type="radio" name="q3" value="slow"> ã¯ã„</label>
      <label><input type="radio" name="q3" value="fast"> ã„ã„ãˆ</label></div>

    <div class="question"><p>4. ç¿Œæœã€é ­ç—›ã‚„å€¦æ€ æ„ŸãŒæ®‹ã‚‹ã“ã¨ãŒå¤šã„ã€‚</p>
      <label><input type="radio" name="q4" value="slow"> ã¯ã„</label>
      <label><input type="radio" name="q4" value="fast"> ã„ã„ãˆ</label></div>

    <div class="question"><p>5. ãŠé…’ã‚’é£²ã‚“ã å¤œã¯çœ ã‚ŠãŒæµ…ããªã‚Šã‚„ã™ã„ã€‚</p>
      <label><input type="radio" name="q5" value="slow"> ã¯ã„</label>
      <label><input type="radio" name="q5" value="fast"> ã„ã„ãˆ</label></div>

    <div class="question"><p>6. ãŠé…’ã‚’é£²ã‚“ã ç¿Œæ—¥ã€é›†ä¸­åŠ›ãŒè½ã¡ã‚‹ã€‚</p>
      <label><input type="radio" name="q6" value="slow"> ã¯ã„</label>
      <label><input type="radio" name="q6" value="fast"> ã„ã„ãˆ</label></div>

    <div class="question"><p>7. å‘¨ã‚Šã®ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã«å¼•ã£å¼µã‚‰ã‚Œã‚„ã™ã„ã€‚</p>
      <label><input type="radio" name="q7" value="emo"> ã¯ã„</label>
      <label><input type="radio" name="q7" value="cool"> ã„ã„ãˆ</label></div>

    <div class="question"><p>8. æ–­ã‚‹ã‚ˆã‚Šã‚‚ã€Œå°‘ã—ã ã‘é£²ã‚‚ã†ã€ã¨æ€ã£ã¦ã—ã¾ã†ã€‚</p>
      <label><input type="radio" name="q8" value="emo"> ã¯ã„</label>
      <label><input type="radio" name="q8" value="cool"> ã„ã„ãˆ</label></div>

    <div class="question"><p>9. é£²ã¿ä¼šã§ã¯é™ã‹ã‚ˆã‚Šã‚‚ç››ã‚Šä¸ŠãŒã£ã¦ã„ãŸã„ã€‚</p>
      <label><input type="radio" name="q9" value="emo"> ã¯ã„</label>
      <label><input type="radio" name="q9" value="cool"> ã„ã„ãˆ</label></div>

    <div class="question"><p>10. ãŠé…’ã‚’é£²ã‚€ã¨æ°—åˆ†ãŒé«˜æšã—ã‚„ã™ã„ã€‚</p>
      <label><input type="radio" name="q10" value="emo"> ã¯ã„</label>
      <label><input type="radio" name="q10" value="cool"> ã„ã„ãˆ</label></div>

    <!-- ğŸ”¹ ä½“èª¿ã¨é£²ã¿ä¼šãƒ¢ãƒ¼ãƒ‰ -->
    <div class="option-group">
      <p>ğŸ”‹ ä½“èª¿ã‚’é¸æŠï¼š</p>
      <label><input type="radio" name="condition" value="1.2"> çµ¶å¥½èª¿</label>
      <label><input type="radio" name="condition" value="1.0" checked> æ™®é€š</label>
      <label><input type="radio" name="condition" value="0.8"> ç–²åŠ´æ°—å‘³</label>

      <p style="margin-top:10px;">ğŸ‰ é£²ã¿ä¼šãƒ¢ãƒ¼ãƒ‰ï¼š</p>
      <label><input type="checkbox" id="partyMode"> ONã«ã™ã‚‹</label>
    </div>

    <button type="button" onclick="showResult()">è¨ºæ–­ã™ã‚‹</button>
  </form>
</div>

<!-- ğŸ”¹ çµæœè¡¨ç¤º -->
<div class="result" id="result">
  <h2 id="typeName"></h2>
  <img id="typeImg" src="" alt="è¨ºæ–­çµæœç”»åƒ">

  <div class="result-box">
    <p class="desc" id="typeDesc"></p>
    <p id="doseResult" class="desc"></p>
  </div>

  :root {
  --radius:14px;
  --shadow:0 6px 16px rgba(0,0,0,0.3);
}

/* ===== ãƒ™ãƒ¼ã‚¹è¨­å®š ===== */
body {
  font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Noto Sans JP",sans-serif;
  color:#fff;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  background-size:400% 400%;
  animation:gradientShift 15s ease infinite;
  margin:0;
  padding:20px;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
}

h1 {
  text-align:center;
  font-size:1.9em;
  margin:20px 0 10px;
  font-weight:700;
  color:#ffd54f;
  text-shadow:0 2px 6px rgba(0,0,0,0.6);
}

/* ===== è³ªå•ãƒ–ãƒ­ãƒƒã‚¯ ===== */
.question, .option-group {
  background:rgba(255,255,255,0.1);
  border:1px solid rgba(255,255,255,0.2);
  border-radius:12px;
  padding:14px;
  margin:12px 0;
  box-shadow:var(--shadow);
}

label {
  margin-right:12px;
  display:inline-block;
}

input[type="radio"], input[type="checkbox"], input[type="number"] {
  accent-color:#ffb300;
}

/* ===== ãƒœã‚¿ãƒ³ ===== */
button {
  display:block;
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  font-size:1.1em;
  font-weight:bold;
  background:linear-gradient(90deg,#ffd54f,#ff7043,#e53935);
  background-size:300% 300%;
  animation:gradientFlow 8s ease infinite;
  color:#fff;
  cursor:pointer;
  box-shadow:0 6px 16px rgba(0,0,0,0.4);
  transition:transform 0.2s ease;
}
button:hover {transform:scale(1.03);}

/* ===== çµæœè¡¨ç¤º ===== */
.result {
  text-align:center;
  display:none;
}
.result h2 {
  font-size:1.8em;
  margin:20px 0 12px;
  text-shadow:0 2px 6px rgba(0,0,0,0.6);
}
.result img {
  margin-top:16px;
  margin-bottom:12px;
  max-width:320px;
  width:90%;
  border-radius:10px;
}

.desc {
  margin-top:10px;
  font-size:0.95em;
  line-height:1.6;
}

.result-box {
  background:linear-gradient(135deg,#111,#000);
  color:#fff;
  border-radius:14px;
  padding:18px 20px;
  box-shadow:0 8px 20px rgba(0,0,0,0.4);
  margin:20px auto;
  max-width:500px;
}

/* ===== é£²é…’é‡å…¥åŠ›æ¬„ ===== */
#intakeInput {
  max-width:560px;
  width:100%;
  margin-top:20px;
}

.drinkRow {
  display:grid;
  grid-template-columns:minmax(160px,1fr) 60px 40px;
  align-items:center;
  gap:6px;
  margin:10px 0;
}
.drinkRow input[type=number] {
  width:100%;
  height:34px;
  text-align:center;
  border-radius:8px;
  border:1px solid rgba(0,0,0,.15);
  background:rgba(255,255,255,.9);
  color:#111;
}
.drinkRow .label {
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.drinkRow .unit {
  text-align:left;
  opacity:.9;
  font-weight:600;
  font-size:1em;
  padding-left:10px; /* â† ã€Œæœ¬ã€ãªã©è¢«ã‚Šé˜²æ­¢ */
}

/* ===== ã‚¹ãƒãƒ›å¯¾å¿œ ===== */
@media(max-width:480px){
  body{padding:10px;}
  h1{font-size:1.5em;}
  .drinkRow{
    grid-template-columns:minmax(120px,1fr)50px40px;
    gap:4px;
  }
  .drinkRow .unit{
    padding-left:14px;
    font-size:0.9em;
  }
}

/* ===== ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã‚¿ã‚¤ãƒ—åˆ¥ç‰¹å¾´ï¼‰ ===== */
.modal {
  display:none;
  position:fixed;
  z-index:50;
  left:0;
  top:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.7);
  backdrop-filter:blur(6px);
  justify-content:center;
  align-items:center;
  overflow-y:auto;
  animation:fadeUp 0.6s ease forwards;
}

.modal-content {
  position:relative;
  background:rgba(0,0,0,0.88);
  border-radius:16px;
  padding:20px 22px 30px;
  box-shadow:0 10px 30px rgba(0,0,0,0.6);
  max-width:640px;
  width:90%;
  transform:translateY(20px);
  animation:cardPop 0.6s ease forwards;
}
@keyframes cardPop {to {transform:translateY(0);opacity:1;}}

.close-btn {
  background:none;
  border:none;
  color:#fff;
  font-size:1.6em;
  font-weight:bold;
  position:absolute;
  right:22px;
  top:12px;
  cursor:pointer;
}

/* ===== ã‚¿ã‚¤ãƒ—åˆ¥ã‚«ãƒ¼ãƒ‰ ===== */
.type-card {
  background:rgba(255,255,255,0.08);
  color:#fff;
  border-radius:14px;
  padding:14px 16px;
  margin:16px auto;
  box-shadow:0 8px 20px rgba(0,0,0,0.4);
}
.type-card h4 {
  text-align:center;
  font-size:1.1em;
  color:#ffd54f;
  margin:10px 0 6px;
}
.type-card ul {
  list-style:none;
  padding:0;
  margin:8px 0 0;
  font-size:0.9em;
  line-height:1.6;
}
.type-card ul li b {color:#ffb300;}
.type-img {
  display:block;
  width:100%;
  max-width:260px;
  margin:0 auto 10px;
  border-radius:10px;
}

/* ===== ã‚¿ã‚¤ãƒ—åˆ¥ãƒœã‚¿ãƒ³ï¼ˆä¸­å¤®å›ºå®šï¼‰ ===== */
.info-btn {
  display:block;
  width:90%;
  max-width:320px;
  margin:40px auto 20px;
  padding:14px;
  font-weight:bold;
  border:none;
  border-radius:10px;
  background:linear-gradient(90deg,#ffb300,#ff7043);
  color:#fff;
  cursor:pointer;
  box-shadow:0 6px 14px rgba(0,0,0,0.4);
  transition:transform 0.2s, box-shadow 0.2s;
}
.info-btn:hover {
  transform:scale(1.05);
  box-shadow:0 8px 18px rgba(0,0,0,0.5);
}

/* ===== ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ ===== */
.fade-in{opacity:0;transform:translateY(8px);animation:fadeUp 1.2s ease forwards;}
@keyframes fadeUp{to{opacity:1;transform:translateY(0);}}
@keyframes gradientShift{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
@keyframes gradientFlow{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}

  // ======== ALTI é£²é…’ã‚¿ã‚¤ãƒ—è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯ v2.1 ========

const alcoholTable = { beer: 20, chu: 20, high: 20, sake: 22, whisky: 19 };

// --- è¨ºæ–­ ---
function showResult() {
  const answeredQ = document.querySelectorAll('input[name^="q"]:checked').length;
  if (answeredQ < 10) {
    alert("ã™ã¹ã¦ã®è³ªå•ã«ç­”ãˆã¦ãã ã•ã„");
    return;
  }

  // ã‚¹ã‚³ã‚¢é›†è¨ˆ
  let score = { slow: 0, fast: 0, emo: 0, cool: 0 };
  document.querySelectorAll('input[name^="q"]:checked')
    .forEach(a => score[a.value]++);

  const axis1 = score.slow > score.fast ? "slow" : "fast";
  const axis2 = score.emo > score.cool ? "emo" : "cool";
  const type = axis1 + "-" + axis2;

  // ãƒ™ãƒ¼ã‚¹é‡
  const baseDoseTable = {
    "slow-emo": 30,
    "fast-emo": 40,
    "fast-cool": 45,
    "slow-cool": 35
  };
  let grams = baseDoseTable[type];

  // ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³å€ç‡
  const cond = parseFloat(document.querySelector('input[name="condition"]:checked').value);
  const party = document.getElementById("partyMode").checked ? 1.5 : 1.0;
  grams = Math.round(grams * cond * party);

  // ã‚¿ã‚¤ãƒ—åˆ¥è¨­å®š
  const data = {
    "slow-emo": {
      name: "ğŸ”¥Slow-Emoï¼ˆæ„Ÿæƒ…ã‚¸ã‚§ãƒƒãƒˆå‹ï¼‰",
      img: "image/slow-emo.png",
      desc: "æ„Ÿæƒ…ãŒç‡ƒãˆã‚„ã™ãã€ãƒšãƒ¼ã‚¹ã‚’è¦‹å¤±ã„ã‚„ã™ã„ã‚¿ã‚¤ãƒ—ã€‚",
      bg: "linear-gradient(135deg,#a94400,#3b1700)"
    },
    "fast-emo": {
      name: "âš¡Fast-Emoï¼ˆç¤¾äº¤ã‚¿ãƒ¼ãƒœå‹ï¼‰",
      img: "image/fast-emo.png",
      desc: "ãƒãƒªã®è‰¯ã•ãŒé­…åŠ›ã®ç¬ç™ºå‹ã€‚",
      bg: "linear-gradient(135deg,#b55a38,#411c14)"
    },
    "fast-cool": {
      name: "â„ï¸Fast-Coolï¼ˆç†æ€§ã‚¹ãƒ—ãƒªãƒ³ãƒˆå‹ï¼‰",
      img: "image/fast-cool.png",
      desc: "ä»£è¬ãŒé€Ÿãã‚¯ãƒ¼ãƒ«ãªç†æ€§ã‚¿ã‚¤ãƒ—ã€‚",
      bg: "linear-gradient(135deg,#455a64,#1c313a)"
    },
    "slow-cool": {
      name: "ğŸŒ¿Slow-Coolï¼ˆæ…é‡ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å‹ï¼‰",
      img: "image/slow-cool.png",
      desc: "ç©ã‚„ã‹ã§å®‰å®šã—ãŸã‚¿ã‚¤ãƒ—ã€‚",
      bg: "linear-gradient(135deg,#2e7d32,#0d5302)"
    }
  };

  const info = data[type];
  document.body.style.background = info.bg;
  document.getElementById("typeName").textContent = info.name;
  document.getElementById("typeImg").src = info.img;
  document.getElementById("typeDesc").textContent = info.desc;

  // æ¨å¥¨æ‘‚å–é‡è¨ˆç®—
  const beer = Math.round(grams / 20),
        chu = Math.round(grams / 20),
        high = Math.round(grams / 20),
        sake = Math.round(grams / 22),
        whisky = Math.round(grams / 19);

  document.getElementById("doseResult").innerHTML =
    `æ¨å¥¨ï¼šç´”ã‚¢ãƒ«ã‚³ãƒ¼ãƒ« ${grams}gï¼æ—¥ ç¨‹åº¦<br>
    ğŸºãƒ“ãƒ¼ãƒ«:${beer}æœ¬ ğŸ¹é…ãƒã‚¤:${chu}ç¼¶ ğŸ¥ƒãƒã‚¤ãƒœãƒ¼ãƒ«:${high}æ¯<br>
    ğŸ¶æ—¥æœ¬é…’:${sake}åˆ ğŸŸ¤ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼:${whisky}æ¯`;

  // è¡¨ç¤ºåˆ‡æ›¿
  document.getElementById("quiz").style.display = "none";
  document.getElementById("result").style.display = "block";
  document.getElementById("intakeInput").style.display = "block";
  window.lastDose = { grams, type };
}

// --- åˆè¨ˆæ‘‚å–é‡ã®åˆ¤å®š ---
function calcTotalIntake() {
  let total = 0;
  for (let key in alcoholTable) {
    const val = parseFloat(document.getElementById(key).value) || 0;
    total += alcoholTable[key] * val;
  }

  const safe = window.lastDose ? window.lastDose.grams : 40;
  const type = window.lastDose ? window.lastDose.type : "fast-cool";

  let msg = "", color = "", advice = "";
  if (total <= safe) {
    msg = `ğŸ€ åˆè¨ˆ ${total}gã€‚ç†æƒ³çš„ãªãƒšãƒ¼ã‚¹ã§ã™ã€‚`;
    color = "#2e7d32";
    advice = type.includes("emo")
      ? "æ°´ã‚’å¤šã‚ã«ã¨ã£ã¦ä½™éŸ»ã‚’æ¥½ã—ã‚‚ã†ã€‚"
      : "è»½ã„é£Ÿäº‹ã¨ä¸€ç·’ã«ãƒªãƒ©ãƒƒã‚¯ã‚¹ã‚’ã€‚";
  } else if (total <= safe * 1.5) {
    msg = `âš ï¸ ${total}gï¼ˆã‚„ã‚„è¶…éï¼‰ã€‚å°‘ã—ãƒšãƒ¼ã‚¹ã‚’è½ã¨ãã†ã€‚`;
    color = "#f9a825";
    advice = type.includes("emo")
      ? "é€”ä¸­ã§ãƒãƒ³ã‚¢ãƒ«ã‚’æŒŸã‚‚ã†ï¼"
      : "æ²¹ã‚‚ã®ã‚’æ§ãˆã¦èƒƒã‚’å®ˆã‚ã†ã€‚";
  } else {
    msg = `ğŸš« ${total}gï¼ˆå±é™ºåŸŸï¼‰ã€‚ä»Šæ—¥ã¯ãƒ–ãƒ¬ãƒ¼ã‚­ã‚’ã€‚`;
    color = "#c62828";
    advice = type.includes("emo")
      ? "ä¸€åº¦æ·±å‘¼å¸ã—ã¦ãƒšãƒ¼ã‚¹ãƒ€ã‚¦ãƒ³ã€‚"
      : "æ°´åˆ†ã‚’ã—ã£ã‹ã‚Šå–ã£ã¦æ—©ã‚ã®ä¼‘æ¯ã‚’ã€‚";
  }

  const out = document.getElementById("intakeResult");
  out.style.color = color;
  out.innerHTML = msg;
  document.getElementById("advice").textContent = advice;
}

// --- å†ã‚¹ã‚¿ãƒ¼ãƒˆ ---
function restart() {
  document.body.style.background = "linear-gradient(135deg,#0f2027,#203a43,#2c5364)";
  document.getElementById("result").style.display = "none";
  document.getElementById("quiz").style.display = "block";
  document.querySelectorAll('input[type=radio],input[type=checkbox]')
    .forEach(el => el.checked = false);
  ['beer', 'chu', 'high', 'sake', 'whisky']
    .forEach(id => document.getElementById(id).value = 0);
  document.getElementById("intakeInput").style.display = "none";
}

// --- ãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡ï¼ˆã‚¿ã‚¤ãƒ—åˆ¥ç‰¹å¾´ï¼‰ ---
const modal = document.getElementById("typeModal");
const toggleBtn = document.getElementById("toggleTypeCards");
const closeBtn = document.getElementById("closeTypeCards");

toggleBtn.addEventListener("click", () => {
  modal.style.display = "flex";
});
closeBtn.addEventListener("click", () => {
  modal.style.display = "none";
});
window.addEventListener("click", (e) => {
  if (e.target === modal) modal.style.display = "none";
});

// --- PWAç™»éŒ² ---
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('âœ… ServiceWorker registered:', reg))
      .catch(err => console.log('âŒ SW registration failed:', err));
  });
}
